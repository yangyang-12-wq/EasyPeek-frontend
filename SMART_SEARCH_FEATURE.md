# 智能搜索功能实现

## 功能概述

EasyPeek新闻系统的智能搜索功能基于AI分析结果，能够进行语义级别的新闻搜索，不仅匹配标题和内容，还能基于AI分析的关键词、主题相关性进行智能匹配。

## 核心特性

### 1. 双模式搜索
- **🤖 AI智能搜索**：基于AI分析的关键词、摘要和语义相关性进行搜索
- **🔍 传统搜索**：基于标题、内容和摘要的文本匹配搜索

### 2. 动态热门关键词
- 基于AI分析结果动态生成热门关键词
- 统计关键词出现频次，按热度排序
- 支持一键搜索热门话题

### 3. 智能匹配算法
- 搜索新闻标题、内容、摘要
- 匹配AI分析的关键词和摘要
- 包含事件关联新闻的搜索
- 主题相关性智能匹配

## 技术实现

### 后端实现

#### 1. 智能搜索服务 (`SmartSearchNews`)
```go
// 智能搜索新闻，基于AI分析的关键词、标题和内容进行相似度匹配
func (s *NewsService) SmartSearchNews(query string, page, pageSize int) ([]models.News, int64, error)
```

**搜索策略：**
- 基础搜索：在新闻标题、内容、摘要中搜索
- AI增强搜索：在AI分析的关键词和摘要中搜索
- 事件关联搜索：搜索与事件相关的新闻
- 结果合并：去重并按相关性排序

#### 2. 热门关键词服务 (`GetHotKeywords`)
```go
// 获取热门关键词（基于AI分析结果）
func (s *NewsService) GetHotKeywords(limit int) ([]string, error)
```

**算法逻辑：**
- 查询最近100条AI分析记录
- 解析并统计关键词频次
- 过滤无效关键词（长度1-20字符）
- 按频次降序排列返回

#### 3. API端点
- `GET /api/v1/news/smart-search` - 智能搜索新闻
- `GET /api/v1/news/hot-keywords` - 获取热门关键词

### 前端实现

#### 1. 搜索模式切换
- 支持AI智能搜索和传统搜索切换
- 实时切换搜索模式并重新搜索
- 不同模式下的UI提示和样式

#### 2. 动态关键词加载
- 页面加载时自动获取热门关键词
- 失败时使用默认关键词作为备用
- 支持点击关键词直接搜索

#### 3. 增强用户体验
- 搜索结果实时加载
- 智能搜索结果标识
- 完善的错误处理和空状态显示
- 响应式设计适配各种设备

## 搜索算法详解

### 智能搜索流程

1. **用户输入关键词** → 系统接收搜索请求
2. **基础搜索** → 在新闻标题、内容、摘要中搜索
3. **AI增强搜索** → 在AI分析数据中搜索：
   ```sql
   SELECT DISTINCT n.* FROM news n
   INNER JOIN ai_analyses a ON (
     (a.target_type = 'news' AND a.target_id = n.id) OR
     (a.target_type = 'event' AND n.belonged_event_id = a.target_id)
   )
   WHERE a.keywords ILIKE ? OR a.summary ILIKE ?
   ```
4. **结果合并** → 去重并按相关性排序
5. **分页返回** → 返回分页结果

### 关键词热度算法

1. **数据收集** → 获取最近AI分析记录
2. **关键词解析** → 按逗号分割关键词
3. **频次统计** → 统计每个关键词出现次数
4. **质量过滤** → 过滤长度不合适的关键词
5. **排序输出** → 按频次降序返回热门关键词

## 使用说明

### 搜索操作
1. 在搜索框输入关键词
2. 选择搜索模式（AI智能搜索/传统搜索）
3. 点击搜索按钮或按回车键
4. 查看搜索结果

### 智能搜索优势
- **语义理解**：理解关键词的含义，不仅匹配字面意思
- **主题关联**：找到主题相关的新闻，即使不包含确切关键词
- **AI增强**：利用AI分析的关键词扩展搜索范围
- **事件关联**：搜索与特定事件相关的所有新闻

### 热门关键词功能
- 显示当前最热门的话题关键词
- 点击关键词可直接搜索相关新闻
- 基于AI分析结果动态更新
- 反映当前新闻热点趋势

## 配置说明

### 后端配置
- 搜索结果分页大小：默认10条
- 热门关键词数量：默认10个，最多50个
- AI分析数据范围：最近100条记录

### 前端配置
- 每页显示新闻数：6条
- 热门关键词显示数：15个
- 默认搜索模式：AI智能搜索

## 性能优化

### 数据库优化
- 在关键词字段上建立索引
- 使用ILIKE进行不区分大小写搜索
- 合理的分页查询避免性能问题

### 前端优化
- 搜索结果缓存
- 防抖搜索减少API调用
- 异步加载热门关键词
- 响应式设计优化移动端体验

## 扩展功能

### 未来计划
- 搜索历史记录
- 个性化搜索推荐
- 搜索结果高亮显示
- 更复杂的语义分析
- 搜索结果相关性评分优化

### 可配置选项
- 搜索模式默认选择
- 热门关键词更新频率
- 搜索结果排序方式
- AI分析数据权重调整

## 技术特点

### 智能化
- 基于AI分析结果的语义搜索
- 动态生成热门关键词
- 主题相关性智能匹配

### 用户友好
- 直观的搜索模式切换
- 清晰的搜索结果展示
- 完善的错误处理

### 高性能
- 高效的数据库查询
- 合理的缓存策略
- 优化的前端渲染

这个智能搜索功能真正实现了从传统的文本匹配搜索向语义理解搜索的升级，让用户能够更准确、更便捷地找到相关新闻内容。 